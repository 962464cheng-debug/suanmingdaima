name: Debug EXPO_TOKEN Secret

on:
  workflow_dispatch:

jobs:
  debug-secret:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: ''

    - name: Debug GitHub Secret
      id: debug-secret
      run: |
        echo "=== Debugging EXPO_TOKEN Secret ==="
        echo "EXPO_TOKEN from secrets: ${{ secrets.EXPO_TOKEN }}"
        echo "EXPO_TOKEN length: ${{ length(secrets.EXPO_TOKEN) }}"
        echo "Is EXPO_TOKEN empty: ${{ secrets.EXPO_TOKEN == '' }}"
        
        # Set the secret to an environment variable
        export EXPO_TOKEN=${{ secrets.EXPO_TOKEN }}
        echo "EXPO_TOKEN from env: $EXPO_TOKEN"
        echo "EXPO_TOKEN env length: ${#EXPO_TOKEN}"
        
        # Test direct assignment
        EXPO_TOKEN_DIRECT=${{ secrets.EXPO_TOKEN }}
        echo "EXPO_TOKEN direct: $EXPO_TOKEN_DIRECT"
        echo "EXPO_TOKEN direct length: ${#EXPO_TOKEN_DIRECT}"
        
        echo "=== Secret debugging completed ==="

    - name: Install EAS CLI
      run: |
        echo "=== Installing EAS CLI ==="
        npm install -g eas-cli
        echo "EAS version: $(eas --version)"
        echo "=== EAS CLI installed ==="

    - name: Test EAS CLI with explicit token
      run: |
        echo "=== Testing EAS CLI with explicit token ==="
        # Pass the token directly to EAS CLI
        eas whoami --token ${{ secrets.EXPO_TOKEN }}
        echo "=== EAS CLI test completed ==="

    - name: Test EAS CLI with env var
      run: |
        echo "=== Testing EAS CLI with env var ==="
        # Set the env var explicitly
        EXPO_TOKEN=${{ secrets.EXPO_TOKEN }} eas whoami
        echo "=== EAS CLI env var test completed ==="
